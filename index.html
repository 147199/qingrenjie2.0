<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, shrink-to-fit=no">
    <title>ğŸ“® ç¥ç§˜å–ä»¶ Â· è°œç›’</title>
    <!-- å¾®ä¿¡å†…ç›´æ¥æ‰“å¼€ï¼Œçº¯äº’åŠ¨ï¼Œå‰ç½®å®Œå…¨ä¸æå·§å…‹åŠ›/ç¤¼ç‰© -->
    <style>
        /* é‡ç½®æ ·å¼ï¼Œæ‰‹æœºå‹å¥½ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'PingFang SC', 'Helvetica Neue', 'SF Pro Text', 'Microsoft YaHei', sans-serif;
            background: radial-gradient(circle at 20% 80%, #f7f1eb, #e9dbd0);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
            /* å¾®ä¿¡å®‰å…¨åŒºé€‚é… */
            padding: constant(safe-area-inset-top) constant(safe-area-inset-right) constant(safe-area-inset-bottom) constant(safe-area-inset-left);
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .puzzle-box {
            max-width: 480px;
            width: 100%;
            background: rgba(255, 244, 235, 0.75);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 56px 56px 44px 44px;
            padding: 30px 24px 40px;
            box-shadow: 0 25px 40px rgba(100, 70, 40, 0.18);
            border: 2px solid rgba(255, 230, 200, 0.7);
            position: relative;
            overflow: hidden;
            transition: all 0.2s;
        }

        /* ç¥ç§˜æ³¢çº¹èƒŒæ™¯ â€” ä¸é€éœ²ä»»ä½•å•†å“ä¿¡æ¯ */
        .bg-whisper {
            position: absolute;
            top: -30px;
            right: -30px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #ffe6d580 0%, transparent 70%);
            border-radius: 50%;
            z-index: 0;
        }

        .content-layer {
            position: relative;
            z-index: 5;
        }

        /* å¤´éƒ¨ â€” å®Œå…¨ä¸­æ€§ï¼Œåªæœ‰é‚®æ”¿/è°œé¢˜æ°›å›´ */
        .header-icon {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .post-badge {
            background: #3b5c4a;
            padding: 10px 20px;
            border-radius: 50px;
            color: #ffefcf;
            font-size: 17px;
            font-weight: 600;
            letter-spacing: 3px;
            box-shadow: 0 6px 0 #1f332b;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .post-badge span {
            font-size: 22px;
        }

        .mystery-tag {
            background: #d2b48c;
            padding: 8px 16px;
            border-radius: 30px;
            color: #2e2e1f;
            font-weight: 600;
            border: 2px dashed #887a5e;
        }

        /* è¿›åº¦æ¡ â€” æ¨¡æ‹Ÿé—¯å…³è¿›åº¦ï¼Œä½†ä¸è¯´ç ´ */
        .track-progress {
            background: #eedcc7;
            padding: 14px 20px;
            border-radius: 100px;
            margin-bottom: 35px;
            border: 2px solid #bba88b;
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            color: #4a3e2b;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.06);
        }

        .stage-name {
            background: #c0a78b;
            color: white;
            padding: 5px 18px;
            border-radius: 50px;
            font-size: 16px;
        }

        /* äº’åŠ¨æ ¸å¿ƒåŒº â€” è°œé¢˜å®¹å™¨ */
        .interact-core {
            background: #faf1e9;
            border-radius: 42px;
            padding: 30px 18px;
            margin-bottom: 25px;
            box-shadow: 0 12px 0 #b29076, 0 18px 35px rgba(110, 70, 40, 0.25);
            border: 3px solid #ffe2c1;
            min-height: 270px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: box-shadow 0.2s;
        }

        .puzzle-figure {
            font-size: 90px;
            line-height: 1;
            margin-bottom: 10px;
            filter: drop-shadow(0 10px 8px rgba(60, 40, 20, 0.15));
            animation: float 4s infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0px); }
        }

        .hint-message {
            font-size: 24px;
            background: #eadac4;
            padding: 14px 30px;
            border-radius: 60px;
            color: #3f2e22;
            font-weight: 650;
            margin: 12px 0 8px;
            text-align: center;
            border: 2px solid #fff3e0;
            box-shadow: 0 5px 0 #a6836a;
            word-break: break-word;
        }

        /* ä¸»æŒ‰é’® â€” é£æ ¼ç»Ÿä¸€ï¼Œä¸æš—ç¤ºç¤¼ç‰© */
        .action-trigger {
            background: #6f5498;
            border: none;
            color: white;
            font-size: 26px;
            font-weight: 700;
            padding: 18px 32px;
            border-radius: 80px;
            width: 100%;
            max-width: 300px;
            margin: 10px auto 0;
            box-shadow: 0 14px 0 #3a2a4b, 0 10px 30px #a07d9e;
            transition: all 0.12s;
            letter-spacing: 6px;
            border: 2px solid #e6c7c2;
            cursor: pointer;
        }

        .action-trigger:active {
            transform: translateY(10px);
            box-shadow: 0 4px 0 #3a2a4b, 0 10px 25px #a07d9e;
        }

        /* æœ€ç»ˆæ­ç§˜åŒº â€” åªæœ‰é€šå…³æ‰ä¼šå‡ºç°ï¼å®Œå…¨ç¬¦åˆï¼šä¸­å›½é‚®æ”¿+å–ä»¶ç  */
        .final-reveal {
            margin-top: 30px;
            background: linear-gradient(165deg, #2d463a, #405a4c);
            border-radius: 32px;
            padding: 24px 22px;
            border: 4px solid #e7ca9e;
            box-shadow: 0 0 40px #fbe1a7, inset 0 0 12px #1a261f;
            color: #fff9e8;
            transition: opacity 0.6s, transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            word-break: break-all;
        }

        .post-row {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            background: #25382f;
            padding: 16px 20px;
            border-radius: 20px;
            margin-bottom: 18px;
            border: 2px solid #cbad7a;
            color: #ffefcf;
        }

        .post-row span {
            font-size: 28px;
        }

        .pickup-row {
            font-size: 26px;
            font-weight: 800;
            background: #1e2d27;
            padding: 20px;
            border-radius: 24px;
            border: 3px solid #fad98b;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff2b5;
            letter-spacing: 5px;
            box-shadow: inset 0 0 12px #0e1512;
        }

        .small-stamp {
            font-size: 18px;
            color: #ecd69f;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .disable-longpress {
            user-select: none;
            -webkit-user-select: none;
        }

        /* éœ‡åŠ¨å°åŠ¨ç”» */
        .shake-effect {
            animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translateX(-2px); }
            20%, 80% { transform: translateX(6px); }
            30%, 50%, 70% { transform: translateX(-8px); }
            40%, 60% { transform: translateX(8px); }
        }

        .action-trigger:disabled {
            opacity: 0.7;
            transform: translateY(6px);
            box-shadow: 0 6px 0 #3a2a4b;
        }

        .footer-note {
            margin-top: 30px;
            text-align: center;
            font-size: 15px;
            color: #7e6a5a;
            letter-spacing: 2px;
        }
    </style>
</head>
<body class="disable-longpress">
    <div class="puzzle-box">
        <div class="bg-whisper"></div>
        <div class="content-layer">
            <!-- å…¨ç¨‹ä¸å‡ºç°å·§å…‹åŠ›ã€å¾·èŠ™ã€ç¤¼ç‰©ç­‰å­—çœ¼ï¼Œåªæœ‰é‚®æ”¿/è°œé¢˜æ°›å›´ -->
            <div class="header-icon">
                <div class="post-badge">
                    <span>ğŸ“¬</span> ä¸­å›½é‚®æ”¿ Â· å¯†å‡½
                </div>
                <div class="mystery-tag">
                    ğŸ² ä¸‰å è°œç›’
                </div>
            </div>

            <!-- åŠ¨æ€é—¯å…³è¿›åº¦æ¡ï¼ŒJavaScriptæ§åˆ¶å†…å®¹ -->
            <div class="track-progress" id="progressTrack">
                <span id="stageLabel">ğŸ” ç¬¬ä¸€é‡ Â· ä¿¡é£</span>
                <span id="stageEmoji">ğŸŒ«ï¸</span>
            </div>

            <!-- äº’åŠ¨æ ¸å¿ƒåŒºåŸŸï¼Œæ¯å…³ä¸åŒè°œé¢˜ï¼ˆå®Œå…¨ä¸æå·§å…‹åŠ›ï¼‰ -->
            <div class="interact-core" id="corePuzzleZone">
                <!-- ç”±JSåŠ¨æ€æ¸²æŸ“ -->
            </div>

            <!-- ä¸»è¦æ“ä½œæŒ‰é’®ï¼Œæ¯å…³è¡Œä¸ºä¸åŒ -->
            <div style="display: flex; justify-content: center;">
                <button class="action-trigger" id="mainAction">ğŸ”“ è§£å¼€</button>
            </div>

            <!-- æœ€ç»ˆç§˜å¯†å±•æ¿ï¼šä¸€å¼€å§‹å®Œå…¨éšè—ï¼Œé—¯å…³æˆåŠŸåæ˜¾ç¤ºé‚®æ”¿å•å·+å–ä»¶ç  -->
            <div id="secretRevealContainer" style="display: none;" class="final-reveal">
                <div class="post-row">
                    <span>ğŸ“®</span> ä¸­å›½é‚®æ”¿å•å·
                </div>
                <div style="font-size: 27px; font-weight: 700; background: #2a4036; padding: 10px 18px; border-radius: 18px; margin-bottom: 20px; border: 2px solid #b9a06e; letter-spacing: 3px; text-align: center;" id="postNumberDisplay">9813896195387</div>
                <div class="pickup-row">
                    <div class="small-stamp">
                        <span>ğŸ“</span> å–ä»¶å¯†ç 
                    </div>
                    <div style="font-size: 38px; font-weight: 900;" id="pickupCodeDisplay">1-1-4007</div>
                    <div style="font-size: 18px; margin-top: 10px; color: #ffe9af;">â€”â€” å‡­æ­¤ç å¼€å¯ â€”â€”</div>
                </div>
            </div>

            <div class="footer-note">
                ğŸŒŠ æ¯ä¸€å éƒ½è—ç€ä¸€å¥æš—è¯­
            </div>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // ---------- å®Œå…¨ä¸­æ€§çš„ä¸‰å è°œç›’ ----------
            // ç»å£ä¸æå·§å…‹åŠ›/å¾·èŠ™/ç¤¼ç‰©ï¼Œåªæœ‰é‚®æ”¿æš—å·é£æ ¼
            const GAME_PHASE = {
                BOX_1: 1,   // ç¬¬ä¸€å ï¼šä¿¡é£ Â· ç‚¹æ˜Ÿ
                BOX_2: 2,   // ç¬¬äºŒå ï¼šæ½®æ± Â· é•¿è¯µ
                BOX_3: 3,   // ç¬¬ä¸‰å ï¼šä¸‰è‰² Â· æ‹¾å¿†
                UNLOCKED: 4 // ç»ˆç« ï¼šå–ä»¶å¯†ä»¤
            };

            let currentPhase = GAME_PHASE.BOX_1;

            // ----- ç¬¬ä¸€å  è¿›åº¦ï¼ˆéœ€è¦ç‚¹å‡»6é¢—æ˜Ÿï¼‰-----
            let phase1Progress = 0;
            const PHASE1_MAX = 6;

            // ----- ç¬¬äºŒå  æ½®æ±ï¼ˆé•¿æŒ‰æ½®æ±æ¶¨æ»¡ï¼‰-----
            let phase2Progress = 0;         // 0 - 100
            const PHASE2_HOLD_MS = 1400;     // é•¿æŒ‰1.4ç§’
            let holdTimer = null;
            let isHolding = false;

            // ----- ç¬¬ä¸‰å  ä¸‰è‰²è®°å¿†ï¼ˆæ”¶é›†ä¸‰æšä¿¡ç‰©ï¼Œä¸æç³–çº¸ï¼‰-----
            let phase3Collected = [];
            const PHASE3_REQUIRED = 3;

            // å›ºå®šå¯†æ–‡ï¼ˆæ‚¨æŒ‡å®šçš„å¿«é€’ä¿¡æ¯ï¼‰
            const CHINA_POST_CODE = "9813896195387";
            const PICKUP_CODE = "1-1-4007";

            // DOM å…ƒç´ 
            const stageLabel = document.getElementById('stageLabel');
            const stageEmoji = document.getElementById('stageEmoji');
            const coreZone = document.getElementById('corePuzzleZone');
            const mainBtn = document.getElementById('mainAction');
            const secretContainer = document.getElementById('secretRevealContainer');
            const postDisplay = document.getElementById('postNumberDisplay');
            const pickupDisplay = document.getElementById('pickupCodeDisplay');

            // é¢„å¡«æœ€ç»ˆä»£ç ï¼ˆä¿è¯æ­£ç¡®ï¼‰
            if (postDisplay) postDisplay.innerText = CHINA_POST_CODE;
            if (pickupDisplay) pickupDisplay.innerText = PICKUP_CODE;

            // ---------- å®Œå…¨ä¸­æ€§çš„æ¸²æŸ“ ----------
            function renderPhase() {
                switch (currentPhase) {
                    case GAME_PHASE.BOX_1:
                        renderBox1();
                        break;
                    case GAME_PHASE.BOX_2:
                        renderBox2();
                        break;
                    case GAME_PHASE.BOX_3:
                        renderBox3();
                        break;
                    case GAME_PHASE.UNLOCKED:
                        renderUnlocked();
                        break;
                }
            }

            // **** ç¬¬ä¸€å ï¼šä¿¡é£ Â· ç‚¹æ˜Ÿ ****
            function renderBox1() {
                stageLabel.innerText = 'ğŸ” ç¬¬ä¸€å  Â· ä¿¡é£';
                stageEmoji.innerText = 'âœ¨ğŸŒ«ï¸';
                mainBtn.innerText = 'âœ¨ ç‚¹æ˜Ÿ';
                mainBtn.disabled = false;
                mainBtn.style.opacity = '1';
                mainBtn.style.transform = '';
                mainBtn.style.boxShadow = '0 14px 0 #3a2a4b, 0 10px 30px #a07d9e';

                let starMarks = '';
                for (let i = 0; i < phase1Progress; i++) starMarks += 'â­';
                for (let i = 0; i < PHASE1_MAX - phase1Progress; i++) starMarks += 'â˜†';
                
                coreZone.innerHTML = `
                    <div class="puzzle-figure">ğŸŒ«ï¸ğŸ“¬</div>
                    <div class="hint-message">ç‚¹äº®ä¿¡é£ä¸­çš„æ˜Ÿæ˜Ÿ</div>
                    <div style="font-size: 42px; letter-spacing: 14px; margin: 6px 0; color: #624c3c;">${starMarks}</div>
                    <div style="font-size: 18px; color: #5c4d3f; background: #e8d7c0; padding: 5px 18px; border-radius: 30px;">è¿˜å·® ${PHASE1_MAX - phase1Progress} é¢—</div>
                `;
            }

            // ç¬¬ä¸€å ç‚¹å‡»è¡Œä¸º
            function handleBox1Action() {
                if (phase1Progress < PHASE1_MAX) {
                    phase1Progress++;
                    // æ™ƒåŠ¨æ•ˆæœï¼Œä½†ä¸æç¤ºç¤¼ç‰©
                    document.querySelector('.interact-core')?.classList.add('shake-effect');
                    setTimeout(() => document.querySelector('.interact-core')?.classList.remove('shake-effect'), 500);
                    
                    if (phase1Progress === PHASE1_MAX) {
                        // è¿›å…¥ç¬¬äºŒå 
                        currentPhase = GAME_PHASE.BOX_2;
                        phase1Progress = 0; // é‡ç½®å˜é‡ï¼Œä½†ç¬¬äºŒå å•ç‹¬å¤„ç†
                        renderPhase();
                    } else {
                        renderBox1();
                    }
                }
            }

            // **** ç¬¬äºŒå ï¼šæ½®æ± Â· é•¿è¯µ ****
            function renderBox2() {
                stageLabel.innerText = 'ğŸŒŠ ç¬¬äºŒå  Â· æ½®æ±';
                stageEmoji.innerText = 'ğŸŒŠğŸŒ€';
                mainBtn.innerText = 'ğŸŒŠ é•¿æŒ‰æ½®æ¶Œ';
                mainBtn.disabled = false;
                // é‡ç½®é•¿æŒ‰å˜é‡
                isHolding = false;
                if (holdTimer) clearInterval(holdTimer);
                holdTimer = null;
                phase2Progress = 0;  // åˆå§‹0ï¼Œæ¯æ¬¡é‡æ–°é•¿æŒ‰ä»0å¼€å§‹ (è°ƒçš®è®¾å®š)
                
                let tidePercent = 0;
                let tideBar = 'â—½'.repeat(10);
                coreZone.innerHTML = `
                    <div class="puzzle-figure">ğŸŒŠğŸ“®</div>
                    <div class="hint-message">é•¿æŒ‰æ½®æ¶Œ Â· æ¼«è¿‡ä¿¡ç¬º</div>
                    <div style="background: #3c5e6b; width: 80%; border-radius: 40px; padding: 5px; margin: 18px 0 6px;">
                        <div style="background: #a2d0d9; width: 0%; border-radius: 40px; height: 24px; transition: width 0.1s;" id="tideFillBar"></div>
                    </div>
                    <div style="font-size: 21px; color: #29505c;" id="tidePercentText">0% æ¼«ä¸Š</div>
                    <div style="font-size: 15px; margin-top: 10px; color: #385b67;">ğŸ¤² æŒ‰ä½ä¸æ¾æ‰‹ï¼Œæ½®æ°´æ‰ä¼šæ¶¨</div>
                `;
            }

            // è§¦æ‘¸äº‹ä»¶ â€”â€” ç¬¬äºŒå ä¸“ç”¨
            function onHoldStart(e) {
                e.preventDefault();
                if (currentPhase !== GAME_PHASE.BOX_2) return;
                if (isHolding) return;
                isHolding = true;
                const startTime = Date.now();
                // é‡ç½®è¿›åº¦ä¸º0å†å¼€å§‹
                phase2Progress = 0;
                updateTideUI(0);
                
                const interval = setInterval(() => {
                    if (!isHolding || currentPhase !== GAME_PHASE.BOX_2) {
                        clearInterval(interval);
                        return;
                    }
                    const elapsed = Date.now() - startTime;
                    phase2Progress = Math.min(elapsed, PHASE2_HOLD_MS);
                    const percent = Math.floor((phase2Progress / PHASE2_HOLD_MS) * 100);
                    updateTideUI(percent);
                    
                    if (phase2Progress >= PHASE2_HOLD_MS) {
                        // é€šå…³ï¼è¿›å…¥ç¬¬ä¸‰å 
                        clearInterval(interval);
                        currentPhase = GAME_PHASE.BOX_3;
                        isHolding = false;
                        phase2Progress = 0;
                        if (holdTimer) clearInterval(holdTimer);
                        renderPhase();
                    }
                }, 50);
                holdTimer = interval;
            }

            function updateTideUI(percent) {
                const tideBar = document.getElementById('tideFillBar');
                const tideText = document.getElementById('tidePercentText');
                if (tideBar) tideBar.style.width = percent + '%';
                if (tideText) tideText.innerText = percent + '% æ¼«ä¸Š';
            }

            function onHoldEnd(e) {
                if (currentPhase === GAME_PHASE.BOX_2) {
                    isHolding = false;
                    if (holdTimer) clearInterval(holdTimer);
                    holdTimer = null;
                    // è°ƒçš®è®¾å®šï¼šæ¾æ‰‹æ½®æ°´é€€å»ï¼Œå½’é›¶
                    phase2Progress = 0;
                    updateTideUI(0);
                }
            }

            // **** ç¬¬ä¸‰å ï¼šä¸‰è‰² Â· æ‹¾å¿†ï¼ˆä½†ä¸è¯´ç³–çº¸ï¼Œè¯´ä¸‰è‰²ä¿¡ç‰©ï¼‰****
            function renderBox3() {
                stageLabel.innerText = 'ğŸ§© ç¬¬ä¸‰å  Â· æ‹¾å¿†';
                stageEmoji.innerText = 'ğŸ”´ğŸŸ¡ğŸ”µ';
                mainBtn.innerText = 'âœ… é›†é½ä¿¡ç‰©';
                mainBtn.disabled = true;   // é€šè¿‡ç‚¹å‡»è‰²å—æ”¶é›†ï¼ŒæŒ‰é’®ä¸å¯ç”¨
                mainBtn.style.opacity = '0.6';
                mainBtn.style.boxShadow = '0 8px 0 #3a2a4b';

                // ä¸‰è‰²è®°å¿†ç¢ç‰‡ï¼ˆçº¢/é»„/è“ï¼‰
                let redStatus = phase3Collected.includes('red') ? 'ğŸ”´' : 'ğŸŸ¥';
                let yellowStatus = phase3Collected.includes('yellow') ? 'ğŸŸ¡' : 'ğŸŸ¨';
                let blueStatus = phase3Collected.includes('blue') ? 'ğŸ”µ' : 'ğŸŸ¦';
                
                coreZone.innerHTML = `
                    <div style="display: flex; justify-content: center; gap: 25px; width: 100%; margin-bottom: 20px;">
                        <div style="font-size: 70px; background: ${phase3Collected.includes('red') ? '#f9cdcd' : '#ffe1e1'}; padding: 12px; border-radius: 30px; box-shadow: 0 8px 0 #a14a4a;" id="redToken">${redStatus}</div>
                        <div style="font-size: 70px; background: ${phase3Collected.includes('yellow') ? '#fff2b5' : '#fff0cc'}; padding: 12px; border-radius: 30px; box-shadow: 0 8px 0 #b68b40;" id="yellowToken">${yellowStatus}</div>
                        <div style="font-size: 70px; background: ${phase3Collected.includes('blue') ? '#c7e2f0' : '#d4ecff'}; padding: 12px; border-radius: 30px; box-shadow: 0 8px 0 #3f7a8c;" id="blueToken">${blueStatus}</div>
                    </div>
                    <div class="hint-message">æ‹¾å–ä¸‰è‰²è®°å¿†ä¿¡ç‰©</div>
                    <div style="display: flex; gap: 18px; margin-top: 16px; font-size: 20px;">
                        <span style="background: #d6c4b2; padding: 8px 20px; border-radius: 40px;">${phase3Collected.includes('red')?'âœ…':'â¬œ'} èµ¤</span>
                        <span style="background: #d6c4b2; padding: 8px 20px; border-radius: 40px;">${phase3Collected.includes('yellow')?'âœ…':'â¬œ'} é‡‘</span>
                        <span style="background: #d6c4b2; padding: 8px 20px; border-radius: 40px;">${phase3Collected.includes('blue')?'âœ…':'â¬œ'} é’</span>
                    </div>
                `;
                attachTokenListeners();
            }

            function attachTokenListeners() {
                setTimeout(() => {
                    const red = document.getElementById('redToken');
                    const yellow = document.getElementById('yellowToken');
                    const blue = document.getElementById('blueToken');
                    if (red) red.addEventListener('click', () => collectToken('red'));
                    if (yellow) yellow.addEventListener('click', () => collectToken('yellow'));
                    if (blue) blue.addEventListener('click', () => collectToken('blue'));
                }, 30);
            }

            function collectToken(color) {
                if (currentPhase !== GAME_PHASE.BOX_3) return;
                if (!phase3Collected.includes(color)) {
                    phase3Collected.push(color);
                    // éœ‡åŠ¨åé¦ˆ
                    document.querySelector('.interact-core')?.classList.add('shake-effect');
                    setTimeout(() => document.querySelector('.interact-core')?.classList.remove('shake-effect'), 400);
                    
                    if (phase3Collected.length === PHASE3_REQUIRED) {
                        // é—¯å…³æˆåŠŸï¼æœ€ç»ˆè§£é”ï¼Œæ˜¾ç¤ºä¸­å›½é‚®æ”¿+å–ä»¶ç 
                        currentPhase = GAME_PHASE.UNLOCKED;
                        renderPhase();
                    } else {
                        renderBox3();
                    }
                }
            }

            // **** ç»ˆç« ï¼šå±•ç¤ºé‚®æ”¿å•å·+å–ä»¶ç  ****
            function renderUnlocked() {
                stageLabel.innerText = 'ğŸ“¯ ç»ˆå  Â· å–ä»¶å¯†ä»¤';
                stageEmoji.innerText = 'ğŸ“¬ğŸ”“';
                mainBtn.style.display = 'none';  // æŒ‰é’®æ¶ˆå¤±
                coreZone.innerHTML = `
                    <div style="font-size: 70px; margin-bottom: 8px;">ğŸ“­â¡ï¸ğŸ“¬</div>
                    <div style="font-size: 26px; background: #a1927a; padding: 18px; border-radius: 60px; color: white; font-weight: bold;">è°œç›’ä¸‰å  Â· ä¸ºæ‚¨å¼€å¯</div>
                `;
                // æ˜¾ç¤ºæœ€ç»ˆç§˜å¯†é¢æ¿
                secretContainer.style.display = 'block';
            }

            // ---------- å…¨å±€äº‹ä»¶ç»‘å®š ----------
            function bindEvents() {
                // ä¸»æŒ‰é’®ç‚¹å‡» (ç”¨äºç¬¬ä¸€å ã€ç¬¬äºŒå æŒ‰é’®æ— æ•ˆä½†è§¦å‘æç¤ºï¼Œç¬¬ä¸‰å ç¦ç”¨)
                mainBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (currentPhase === GAME_PHASE.BOX_1) {
                        handleBox1Action();
                    } else if (currentPhase === GAME_PHASE.BOX_2) {
                        alert('ğŸŒŠ è¦æŒ‰ä½æ½®æ°´æ‰ä¼šæ¶¨å–”ï½');
                    } else if (currentPhase === GAME_PHASE.BOX_3) {
                        // æŒ‰é’®ç¦ç”¨ï¼Œä½†ä»¥é˜²ä¸‡ä¸€
                    }
                });

                // ç¬¬äºŒå é•¿æŒ‰ç›‘å¬
                mainBtn.addEventListener('touchstart', onHoldStart, { passive: false });
                mainBtn.addEventListener('touchend', onHoldEnd);
                mainBtn.addEventListener('touchcancel', onHoldEnd);

                // ç¦ç”¨å³é”®èœå•ã€å¾®ä¿¡é•¿æŒ‰èœå•
                document.addEventListener('contextmenu', (e) => e.preventDefault());
            }

            // åˆå§‹åŒ–æ¸¸æˆï¼Œå®Œå…¨ä¸æå·§å…‹åŠ›/ç¤¼ç‰©
            function init() {
                // ç¡®ä¿æœ€ç»ˆé¢æ¿éšè—
                secretContainer.style.display = 'none';
                mainBtn.style.display = 'block';
                renderPhase();
                bindEvents();
            }

            init();
        })();
    </script>
</body>
</html>